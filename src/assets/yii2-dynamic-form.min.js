function initTemplate(t,e){var i=$("#"+t.formId).yiiActiveForm("data");return void 0!==i&&(e.find("."+i.settings.errorCssClass).removeClass(i.settings.errorCssClass),e.find("."+i.settings.successCssClass).removeClass(i.settings.successCssClass)),e}!function($){var pluginName="yiiDynamicForm",regexID=/^(.+?)([-\d-]{1,})(.+)$/i,regexName=/(^.+?)([\[\d{1,}\]]{1,})(\[.+\]$)/i;$.fn.yiiDynamicForm=function(t){return methods[t]?methods[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?($.error("Method "+t+" does not exist on jQuery.yiiDynamicForm"),!1):methods.init.apply(this,arguments)};var events={beforeInsert:"beforeInsert",afterInsert:"afterInsert",beforeDelete:"beforeDelete",afterDelete:"afterDelete",limitReached:"limitReached"},methods={init:function(t){return this.each(function(){t.template=_parseTemplate(t)})},addItem:function(t,e,i){_addItem(t,e,i)},deleteItem:function(t,e,i){_deleteItem(t,e,i)},updateContainer:function(){var widgetOptions=eval($(this).attr("data-dynamicform"));_updateAttributes(widgetOptions),_fixFormValidaton(widgetOptions)}},_parseTemplate=function(widgetOptions){var $template=$(widgetOptions.template);return $template.find("div[data-dynamicform]").each(function(){var widgetOptions=eval($(this).attr("data-dynamicform"));if($(widgetOptions.widgetItem).length>1){var item=$(this).find(widgetOptions.widgetItem).first()[0].outerHTML;$(this).find(widgetOptions.widgetBody).html(item)}}),$template.find("input, textarea, select").each(function(){if($(this).is(":checkbox")||$(this).is(":radio")){var t=$(this).is(":checkbox")?"checkbox":"radio",e=$(this).attr("name"),i=$template.find('input[type="hidden"][name="'+e+'"]').first(),n=$template.find('input[type="'+t+'"][name="'+e+'"]').length;i&&1===n&&($(this).val(1),i.val(0)),$(this).prop("checked",!1)}else $(this).is("select")?$(this).find("option:selected").removeAttr("selected"):$(this).val("")}),initTemplate(widgetOptions,$template)},_getWidgetOptionsRoot=function(widgetOptions){return eval($(widgetOptions.widgetBody).parents("div[data-dynamicform]").last().attr("data-dynamicform"))},_getLevel=function(t){var e=t.parents("div[data-dynamicform]").length;return e<0?0:e},_count=function(t,e){return t.closest("."+e.widgetContainer).find(e.widgetItem).length},_createIdentifiers=function(t){return Array(t+2).join("0").split("")},_addItem=function(t,e,i){_count(i,t)<t.limit?($newclone=($toclone=$(t.template)).clone(!1,!1),"top"===t.insertPosition?i.closest("."+t.widgetContainer).find(t.widgetBody).prepend($newclone):i.closest("."+t.widgetContainer).find(t.widgetBody).append($newclone),_updateAttributes(t),_fixFormValidaton(t),i.closest("."+t.widgetContainer).triggerHandler(events.afterInsert,$newclone)):i.closest("."+t.widgetContainer).triggerHandler(events.limitReached,t.limit)},_removeValidations=function($elem,widgetOptions,count){if(count>1){$elem.find("div[data-dynamicform]").each(function(){for(var currentWidgetOptions=eval($(this).attr("data-dynamicform")),level=_getLevel($(this)),identifiers=_createIdentifiers(level),numItems=$(this).find(currentWidgetOptions.widgetItem).length,i=1;i<=numItems-1;i++){var aux=identifiers;aux[level]=i,currentWidgetOptions.fields.forEach(function(t){var e=t.id.replace("{}",aux.join("-"));"undefined"!==$("#"+currentWidgetOptions.formId).yiiActiveForm("find",e)&&$("#"+currentWidgetOptions.formId).yiiActiveForm("remove",e)})}});var level=_getLevel($elem.closest("."+widgetOptions.widgetContainer)),widgetOptionsRoot=_getWidgetOptionsRoot(widgetOptions),identifiers=_createIdentifiers(level);identifiers[0]=$(widgetOptionsRoot.widgetItem).length-1,identifiers[level]=count-1,widgetOptions.fields.forEach(function(t){var e=t.id.replace("{}",identifiers.join("-"));"undefined"!==$("#"+widgetOptions.formId).yiiActiveForm("find",e)&&$("#"+widgetOptions.formId).yiiActiveForm("remove",e)})}},_deleteItem=function(t,e,i){var n=_count(i,t);n>t.min&&($todelete=i.closest(t.widgetItem),!1!==$("."+t.widgetContainer).triggerHandler(events.beforeDelete,$todelete)&&(_removeValidations($todelete,t,n),$todelete.remove(),_updateAttributes(t),_fixFormValidaton(t),$("."+t.widgetContainer).triggerHandler(events.afterDelete)))},_updateAttrID=function($elem,index){var widgetOptions=eval($elem.closest("div[data-dynamicform]").attr("data-dynamicform")),id=$elem.attr("id"),newID=id;if(void 0!==id){var matches=id.match(regexID);if(matches&&4===matches.length){matches[2]=matches[2].substring(1,matches[2].length-1);var identifiers=matches[2].split("-");if(identifiers[0]=index,identifiers.length>1){var widgetsOptions=[];$elem.parents("div[data-dynamicform]").each(function(i){widgetsOptions[i]=eval($(this).attr("data-dynamicform"))}),widgetsOptions=widgetsOptions.reverse();for(var i=identifiers.length-1;i>=1;i--)void 0!==widgetsOptions[i]&&(identifiers[i]=$elem.closest(widgetsOptions[i].widgetItem).index())}newID=matches[1]+"-"+identifiers.join("-")+"-"+matches[3],$elem.attr("id",newID)}else newID=id+index,$elem.attr("id",newID)}return id!==newID&&($elem.closest(widgetOptions.widgetItem).find(".field-"+id).each(function(){$(this).removeClass("field-"+id).addClass("field-"+newID)}),$elem.closest(widgetOptions.widgetItem).find("label[for='"+id+"']").attr("for",newID)),newID},_updateAttrName=function($elem,index){var name=$elem.attr("name");if(void 0!==name){var matches=name.match(regexName);if(matches&&4===matches.length){matches[2]=matches[2].replace(/\]\[/g,"-").replace(/\]|\[/g,"");var identifiers=matches[2].split("-");if(identifiers[0]=index,identifiers.length>1){var widgetsOptions=[];$elem.parents("div[data-dynamicform]").each(function(i){widgetsOptions[i]=eval($(this).attr("data-dynamicform"))}),widgetsOptions=widgetsOptions.reverse();for(var i=identifiers.length-1;i>=1;i--)identifiers[i]=$elem.closest(widgetsOptions[i].widgetItem).index()}name=matches[1]+"["+identifiers.join("][")+"]"+matches[3],$elem.attr("name",name)}}return name},_updateAttributes=function(t){var e=_getWidgetOptionsRoot(t);$(e.widgetItem).each(function(t){$(this),$(this).find("*").each(function(){_updateAttrID($(this),t),_updateAttrName($(this),t)})})},_fixFormValidatonInput=function(t,e,i,n){void 0!==e&&((e=$.extend(!0,{},e)).id=i,e.container=".field-"+i,e.input="#"+i,e.name=n,e.value=$("#"+i).val(),e.status=0,"undefined"!==$("#"+t.formId).yiiActiveForm("find",i)&&$("#"+t.formId).yiiActiveForm("remove",i),$("#"+t.formId).yiiActiveForm("add",e))},_fixFormValidaton=function(widgetOptions){var widgetOptionsRoot=_getWidgetOptionsRoot(widgetOptions);$(widgetOptionsRoot.widgetBody).find("input, textarea, select").each(function(){var id=$(this).attr("id"),name=$(this).attr("name");if(void 0!==id&&void 0!==name){currentWidgetOptions=eval($(this).closest("div[data-dynamicform]").attr("data-dynamicform"));var matches=id.match(regexID);if(matches&&4===matches.length){matches[2]=matches[2].substring(1,matches[2].length-1);var level=_getLevel($(this)),identifiers=_createIdentifiers(level-1),baseID=matches[1]+"-"+identifiers.join("-")+"-"+matches[3],attribute=$("#"+currentWidgetOptions.formId).yiiActiveForm("find",baseID);_fixFormValidatonInput(currentWidgetOptions,attribute,id,name)}}})};$("div[data-dynamicform]").on("afterInsert",function(e,item){let childDatePicker=$(item).find("[data-krajee-datetimepicker]"),childSelect2=$(item).find("[data-krajee-select2]");childDatePicker.length>0&&childDatePicker.each(function(){$(this).data("datetimepicker")&&$(this).datetimepicker("destroy");let dateTimePickerOptions=eval($(this).attr("data-krajee-datetimepicker"));$(this).datetimepicker(dateTimePickerOptions)}),childSelect2.length>0&&childSelect2.each(function(){$(this).data("select2")&&$(this).select2("destroy");let s2Init=eval($(this).attr("data-krajee-select2")),s2Options=eval($(this).attr("data-s2-options")),s2id=$(this).attr("id");$.when($(this).select2(s2Init)).done(initS2Loading(s2id,s2Options)),$(this).parent().find(".kv-plugin-loading").hide(),$(this).val(null).trigger("change")})})}(window.jQuery);
